-- VHDL Entity hsio.clocks_main.symbol
--
-- Created by Matt Warren 2014
--
-- Generated by Mentor Graphics' HDL Designer(TM) 2013.1 (Build 6)
--

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;
library utils;
use utils.pkg_types.all;
library hsio;
use hsio.pkg_core_globals.all;

entity clocks_main is
   generic( 
      SIM_MODE : integer := 0
   );
   port( 
      clk                    : in     std_logic;
      clk125                 : in     std_logic;
      clk40                  : in     std_logic;
      clk_bco_dutycycle_we_i : in     std_logic;
      clk_twin_phase_we_i    : in     std_logic;
      clks_top_ready_i       : in     std_logic;
      -- registers
      reg                    : in     t_reg_bus;
      rst                    : in     std_logic;
      rst125                 : in     std_logic;
      clk160ps               : out    std_logic;
      clks_main_ready_o      : out    std_logic;
      stat_o                 : out    std_logic_vector (3 downto 0)
   );

-- Declarations

end clocks_main ;

-- VHDL from Block Diagram 
-- Generated by Mentor Graphics HDL Designer(TM) 2013.1 (Build 6) 
--
-- hsio.clocks_main.struct
--
-- Created by Matt Warren 2014
--

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;
use ieee.numeric_std.all;
library UNISIM;
use UNISIM.all;

library utils;
use utils.pkg_types.all;

library hsio;
use hsio.pkg_core_globals.all;
use hsio.pkg_hsio_globals.all;




architecture struct of clocks_main is

   -- Architecture declarations

   -- Internal signal declarations
   signal HI                 : std_logic;
   signal LO                 : std_logic;
   signal bco_daddr          : std_logic_vector(6 downto 0);
   signal bco_den            : std_logic;
   signal bco_di             : std_logic_vector(15 downto 0);
   signal bco_drdy           : std_logic;
   signal bco_dwe            : std_logic;
   signal bco_psbusy         : std_logic;
   signal bco_psdone         : std_logic;
   signal clk40_ext1_sel     : std_logic;
   signal clk_bco_dc_sel     : std_logic;
   signal clk_bco_phase_we_i : std_logic;
   signal clk_dcmext_locked  : std_ulogic;
   signal clk_ext_en         : std_logic;
   signal clk_ext_sel        : std_logic;
   signal clks_top_ready     : std_logic;
   signal clks_top_ready_n   : std_logic;
   signal dcm160_locked      : std_logic;
   signal dcm_bco_locked     : std_logic;
   signal dcm_clk_in         : std_logic;
   signal dcm_dbco_locked    : std_logic;
   signal dcm_ps_lock        : std_logic;
   signal dcm_rst_in         : std_logic;
   signal regbus_data_i      : std_logic_vector(15 downto 0);
   signal rst_dcmext         : std_logic;
   signal twin_daddr         : std_logic_vector(6 downto 0);
   signal twin_den           : std_logic;
   signal twin_di            : std_logic_vector(15 downto 0);
   signal twin_drdy          : std_logic;
   signal twin_dwe           : std_logic;
   signal twin_psbusy        : std_logic;
   signal twin_psdone        : std_logic;


attribute KEEP : string;
--attribute KEEP of clk_dbco : signal is "true";
--attribute KEEP of clk_bco_nodc : signal is "true";

   -- Component Declarations
   component cg_dcm_80_160_ps
   port (
      CLKIN_IN    : in     std_logic;
      DADDR_IN    : in     std_logic_vector (6 downto 0);
      DCLK_IN     : in     std_logic;
      DEN_IN      : in     std_logic;
      DI_IN       : in     std_logic_vector (15 downto 0);
      DWE_IN      : in     std_logic;
      PSCLK_IN    : in     std_logic;
      PSEN_IN     : in     std_logic;
      PSINCDEC_IN : in     std_logic;
      RST_IN      : in     std_logic;
      CLK0_OUT    : out    std_logic;
      CLK2X_OUT   : out    std_logic;
      DRDY_OUT    : out    std_logic;
      LOCKED_OUT  : out    std_logic;
      PSDONE_OUT  : out    std_logic
   );
   end component;
   component dcm_conf
   port (
      clk      : in     std_logic;
      delay_i  : in     std_logic_vector (9 downto 0);
      drdy_i   : in     std_logic;
      go_i     : in     std_logic;
      psdone_i : in     std_logic;
      rst      : in     std_logic;
      daddr_o  : out    std_logic_vector (6 downto 0);
      den_o    : out    std_logic;
      di_o     : out    slv16;
      dwe_o    : out    std_logic;
      psbusy_o : out    std_logic
   );
   end component;
   component xilinx_reset
   port (
      clk      : in     std_ulogic ;
      ready_i  : in     std_logic ;
      reset_no : out    std_ulogic ;
      reset_o  : out    std_ulogic ;
      resetq_o : out    std_logic 
   );
   end component;
   component BUFGCTRL
   generic (
      INIT_OUT     : integer := 0;
      PRESELECT_I0 : boolean := false;
      PRESELECT_I1 : boolean := false
   );
   port (
      CE0     : in     std_ulogic;
      CE1     : in     std_ulogic;
      I0      : in     std_ulogic;
      I1      : in     std_ulogic;
      IGNORE0 : in     std_ulogic;
      IGNORE1 : in     std_ulogic;
      S0      : in     std_ulogic;
      S1      : in     std_ulogic;
      O       : out    std_ulogic
   );
   end component;
   component m_power
   port (
      hi : out    std_logic ;
      lo : out    std_logic 
   );
   end component;


begin
   -- Architecture concurrent statements
   -- HDL Embedded Text Block 2 eb2
   -- eb1 1
   clk_bco_dc_sel <= reg(R_CONTROL)(CTL_BCO_DC_EN);

   -- HDL Embedded Text Block 3 eb3
   -- eb2 2
   stat_o(3) <= LO;
   stat_o(2) <= LO;
   stat_o(1) <= LO;
   stat_o(0) <= dcm_ps_lock;


   -- ModuleWare code(v1.12) for instance 'U_6' of 'and'
   clks_main_ready_o <= dcm_ps_lock and dcm_dbco_locked;

   -- ModuleWare code(v1.12) for instance 'U_2' of 'inv'
   clks_top_ready_n <= not(clks_top_ready_i);

   -- Instance port mappings.
   Udcm160ps : cg_dcm_80_160_ps
      port map (
         CLKIN_IN    => dcm_clk_in,
         DADDR_IN    => twin_daddr,
         DCLK_IN     => clk,
         DEN_IN      => twin_den,
         DI_IN       => twin_di,
         DWE_IN      => twin_dwe,
         PSCLK_IN    => clk,
         PSEN_IN     => LO,
         PSINCDEC_IN => LO,
         RST_IN      => dcm_rst_in,
         CLK0_OUT    => open,
         CLK2X_OUT   => clk160ps,
         DRDY_OUT    => twin_drdy,
         LOCKED_OUT  => dcm_ps_lock,
         PSDONE_OUT  => twin_psdone
      );
   Udcmconftwin : dcm_conf
      port map (
         delay_i  => reg(R_TWIN_DELAY)(9 downto 0),
         go_i     => clk_twin_phase_we_i,
         psdone_i => twin_psdone,
         psbusy_o => twin_psbusy,
         daddr_o  => twin_daddr,
         den_o    => twin_den,
         di_o     => twin_di,
         dwe_o    => twin_dwe,
         drdy_i   => twin_drdy,
         clk      => clk,
         rst      => rst
      );
   Uxrstbcodc : xilinx_reset
      port map (
         clk      => dcm_clk_in,
         ready_i  => clks_top_ready_i,
         reset_no => open,
         reset_o  => dcm_rst_in,
         resetq_o => open
      );
   Ubufgctrl : BUFGCTRL
      generic map (
         INIT_OUT     => 0,
         PRESELECT_I0 => false,
         PRESELECT_I1 => false
      )
      port map (
         O       => dcm_clk_in,
         CE0     => HI,
         CE1     => HI,
         I0      => clk125,
         I1      => clk,
         IGNORE0 => HI,
         IGNORE1 => HI,
         S0      => clks_top_ready_n,
         S1      => clks_top_ready_i
      );
   Umpower : m_power
      port map (
         hi => HI,
         lo => LO
      );

end struct;
